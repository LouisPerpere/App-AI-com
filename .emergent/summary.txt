<analysis>
This trajectory details a complex development process, moving the Claire et Marcus PWA forward with significant feature additions and extensive debugging. The AI engineer tackled persistent frontend authentication issues, a full data migration, critical fixes to AI-driven website analysis (including transitioning from an emergent LLM key to a personal OpenAI key and correcting model references), and the successful implementation of a Claude Sonnet 4 LLM backup system. A sophisticated intelligent LLM selection strategy, based on business objectives and platform, was also integrated. A major challenge encountered was an external proxy/cache hindering the deployment of new backend features, which required an immediate frontend workaround. The work culminated in diagnosing a new Invalid platform app error for Instagram integration, indicating a continued, albeit more specific, challenge in social media connectivity.
</analysis>

<product_requirements>
The Claire et Marcus PWA aims to automate social media for small businesses. Users generate Instagram calendars with visuals, text, and scheduling, drawing from business profiles, website analysis, uploads, and notes. Content should be balanced, audience-prioritized, and free of AI-generated language/excessive emojis, with post count adapting to . Users must modify posts, attach/modify visuals (library, Pixabay, upload) with usage indicators, and handle carousels. Content organization features monthly collapsible sections with improved UI/UX. The backend uses  for images, saves business profiles persistently, and supports full post deletion. Interactive feedback includes spinners, progress overlays, and automatic page reload/scroll-to-modified-post. Recent additions include an Instagram integration roadmap (connect account, auto-publish, analytics), refined Coordonnées and Notes explanations, and a Privacy Policy page. The user explicitly requested an Instagram integration fix, migration of photos from a preview database to production, and switching to a personal OpenAI GPT-4o key while removing the emergent key. Later, a Claude Sonnet 4 backup for LLM functionality was requested, along with an intelligent LLM selection strategy based on Objectif de résultats (conversion, community, balanced) and Ton de marque (storytelling).
</product_requirements>

<key_technical_concepts>
-   **Full-stack Development**: React.js (Frontend), FastAPI (Backend), MongoDB/GridFS (Database).
-   **State Management**: , ,  in React.
-   **API Integration**: RESTful endpoints,  (frontend).
-   **LLM Integration**: OpenAI GPT-4o, Claude Sonnet 4 (via ).
-   **Authentication**: JWT, OAuth (Instagram Graph API).
-   **Data Handling**: MongoDB UUIDs, ISO strings for DateTime, data migration.
-   **Deployment**: Kubernetes Ingress rules, Nginx/Google proxy challenges.
</key_technical_concepts>

<code_architecture>

-   ****:
    -   **Importance**: Main FastAPI application.
    -   **Changes Made**: Added Pydantic models for social connections and Instagram. Added API endpoints for social media (, , ). Included new comparison endpoints (, ) and a temporary  for testing LLM selection logic. A temporary  was also added.
-   ****:
    -   **Importance**: Handles AI-driven social media post generation.
    -   **Changes Made**: Modified to use the new  for all LLM calls, implementing  for intelligent LLM selection based on business profile, objective, tone, and platform. Updated  to include  and  from the business profile.
-   ****:
    -   **Importance**: Handles AI-driven website analysis.
    -   **Changes Made**: Removed hardcoded  and  import. Configured to use  directly for GPT-4o. All references from  to  were updated. Initialized  to prevent . Integrated  for primary/backup LLM calls.
-   ****:
    -   **Importance**: This was the old  which was conflicting with .
    -   **Changes Made**: Renamed from  to  to resolve routing conflicts.
-   ** (NEW)**:
    -   **Importance**: New module to abstract LLM calls, providing a unified interface with automatic fallback from OpenAI GPT-4o to Claude Sonnet 4.
    -   **Changes Made**: Created with  class to manage  and  initialization. Implements  for standard LLM calls and  for intelligent LLM selection based on , , and .
-   ****:
    -   **Importance**: Central React component.
    -   **Changes Made**: Frontend  URL corrected from preview to production. Corrected environment variable access from  to . Implemented Instagram OAuth UI components. Implemented a temporary workaround for website analysis by conditionally using a local backend URL (localhost) if the external URL response is generic, to bypass proxy/caching issues. Added a new dropdown for Objectif de résultats (Conversion, Communauté, Équilibré) and an option Storytelling to Ton de marque in the business profile form.
-   ****:
    -   **Importance**: Handles user authentication.
    -   **Changes Made**: Corrected environment variable access from  to . Fixed an issue where  was called without parameters while  in  expected .  is now correctly passed. Debugged login button event handling.
-   ****:
    -   **Importance**: Environment variables.
    -   **Changes Made**:  was added with the user-provided key.
-   ** (NEW temporary script)**:
    -   **Importance**: A one-off script created to migrate user photo data from a preview environment user ID to a production user ID.
    -   **Changes Made**: Created to connect to MongoDB, find photos associated with the old user ID, update their  and references, and save them to the new user ID.
-   ** (NEW temporary script)**:
    -   **Importance**: A simple HTML file for isolating and testing frontend authentication logic outside the main React application.
    -   **Changes Made**: Created to verify direct API calls for login and health check.
</code_architecture>

<pending_tasks>
-   Diagnose and fix the Invalid platform app error for Instagram connection.
-   Resolve the persistent frontend authentication issues that prevent users from logging into the main dashboard and subsequently testing other features via the UI.
-   Diagnose and fix the carousel deletion issue.
-   Diagnose and fix the recurring photo modification issue (blue question mark).
-   Implement the Valider (Validate) button to trigger automatic post publication on Instagram.
-   Implement the scheduling system for automated publications.
-   Implement the analytics dashboard for published posts.
-   Address the website analysis remaining issues (library import - though the core analysis logic is now fixed).
-   Work with the infrastructure team to resolve the external proxy/cache issue that prevents new backend endpoints from being accessible via the public URL.
</pending_tasks>

<current_work>
Immediately before this summary request, the AI engineer was confronted with a user report regarding the Instagram social connect button. When clicked, it redirects to , showing an error message Requête non valide: Les paramètres de demandes ne sont pas valides : Invalid platform app. This indicates a specific configuration error related to the Instagram OAuth setup or the parameters being sent during the authorization request.

This issue blocks further progress on the Instagram integration roadmap, including post publication and analytics. It is crucial to note that while the Instagram OAuth endpoints were implemented in the backend and frontend, the underlying general frontend authentication problem has been a persistent blocker throughout the trajectory, preventing a full end-to-end test of this feature through the UI. The Invalid platform app error suggests a problem deeper than just the general login flow, likely specific to the Instagram Graph API application settings or the / parameters used.

The AI engineer has just begun diagnosing this specific error by Vérification de la configuration OAuth actuelle.
</current_work>

<optional_next_step>
Diagnose the Invalid platform app error by verifying Instagram OAuth configuration and parameters.
</optional_next_step>
